#!/usr/bin/env python3

import sys
import json

log = lambda *x, **y: print(*x, **y, file=sys.stderr)

_current = json.load(sys.stdin)


def makedict(data):

    out = {}

    for cell in data:

        key = cell['ESSID'], cell['address'], cell['channel']
        value = cell['strength']

        out[key] = value

    return out

current = makedict(_current)
currentkeys = set(current.keys())
log(current)

args = sys.argv[1:]

candidates = []

for arg in args:

    with open(arg) as _data:
        data = json.load(_data)

    tag = data['tag']
    _reference = data['fingerprint']
    reference = makedict(_reference)
    log(tag, reference)

    referencekeys = set(reference.keys())
    allkeys = referencekeys.union(currentkeys)

    distance = 0

    for key in allkeys:

        distance += (current.get(key, 0) - reference.get(key, 0))**2

    n = len(allkeys)

    rmsd = (distance / n)**(1 / 2)

    candidates.append((tag, rmsd))

json.dump(sorted(candidates, key=lambda x: (x[1], x[0])), sys.stdout)
